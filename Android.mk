LOCAL_PATH := $(call my-dir)
include $(CLEAR_VARS)

# List obtained using
# adb shell busybox --list |sed 's/.$/ \\/' |sed 's/^/\t/'
BUSYBOX_TOOLS := \
    [ \
	[[ \
	add-shell \
	addgroup \
	adduser \
	adjtimex \
	ar \
	arch \
	arp \
	ash \
	awk \
	base64 \
	basename \
	bbconfig \
	blkdiscard \
	blockdev \
	brctl \
	bunzip2 \
	bzcat \
	bzip2 \
	cal \
	cat \
	chattr \
	chgrp \
	chmod \
	chown \
	chroot \
	chrt \
	cksum \
	clear \
	cmp \
	comm \
	conspy \
	cp \
	cpio \
	cut \
	date \
	dc \
	dd \
	delgroup \
	deluser \
	devmem \
	df \
	diff \
	dirname \
	dmesg \
	dnsd \
	dnsdomainname \
	dos2unix \
	dpkg \
	dpkg-deb \
	du \
	echo \
	ed \
	egrep \
	env \
	expand \
	expr \
	factor \
	false \
	fatattr \
	fbset \
	fdisk \
	fgrep \
	find \
	findfs \
	flock \
	fold \
	free \
	fsck \
	fsfreeze \
	fstrim \
	fsync \
	ftpd \
	ftpget \
	ftpput \
	fuser \
	getopt \
	getty \
	grep \
	groups \
	gunzip \
	hd \
	hdparm \
	head \
	hexdump \
	hostname \
	httpd \
	hwclock \
	id \
	ifconfig \
	insmod \
	install \
	ionice \
	iostat \
	ipaddr \
	ipcalc \
	iplink \
	iproute \
	iprule \
	iptunnel \
	kill \
	killall \
	killall5 \
	less \
	link \
	ln \
	login \
	logname \
	losetup \
	lpd \
	lpq \
	lpr \
	ls \
	lsattr \
	lsmod \
	lsof \
	lspci \
	lsscsi \
	lsusb \
	lzcat \
	lzma \
	lzop \
	lzopcat \
	makedevs \
	makemime \
	man \
	md5sum \
	microcom \
	mkdir \
	mkdosfs \
	mke2fs \
	mkfifo \
	mknod \
	mkswap \
	mktemp \
	modinfo \
	modprobe \
	more \
	mount \
	mountpoint \
	mpstat \
	mv \
	nbd-client \
	nc \
	netstat \
	nice \
	nl \
	nmeter \
	nohup \
	ntpd \
	od \
	partprobe \
	paste \
	patch \
	pgrep \
	pidof \
	pipe_progress \
	pkill \
	pmap \
	popmaildir \
	poweroff \
	powertop \
	printenv \
	printf \
	ps \
	pscan \
	pstree \
	pwd \
	pwdx \
	rdate \
	rdev \
	readlink \
	realpath \
	reformime \
	remove-shell \
	renice \
	reset \
	resize \
	rev \
	rm \
	rmdir \
	rmmod \
	route \
	rpm2cpio \
	run-parts \
	script \
	scriptreplay \
	sed \
	sendmail \
	seq \
	setserial \
	setsid \
	sha1sum \
	sha256sum \
	sha3sum \
	sha512sum \
	shred \
	shuf \
	sleep \
	smemcap \
	sort \
	split \
	ssl_client \
	stat \
	strings \
	stty \
	sum \
	swapoff \
	swapon \
	sync \
	sysctl \
	tac \
	tail \
	tar \
	tcpsvd \
	tee \
	telnet \
	telnetd \
	test \
	tftp \
	tftpd \
	time \
	timeout \
	top \
	touch \
	tr \
	traceroute \
	true \
	truncate \
	tty \
	ttysize \
	tunctl \
	udpsvd \
	uevent \
	umount \
	uname \
	uncompress \
	unexpand \
	uniq \
	unix2dos \
	unlink \
	unlzma \
	unlzop \
	unxz \
	unzip \
	uptime \
	usleep \
	uudecode \
	uuencode \
	vconfig \
	vi \
	volname \
	watch \
	wc \
	wget \
	which \
	whoami \
	whois \
	xargs \
	xxd \
	xz \
	xzcat \
	yes \
	zcat

LOCAL_MODULE := busybox

BUSYBOX_INSTALL_DIR := $(TARGET_OUT)/bin
BUSYBOX_BINARY := $(BUSYBOX_INSTALL_DIR)/busybox
BUSYBOX_LOCAL_BINARY := $(LOCAL_PATH)/busybox-android
# This dependency ensures busybox is installed after all toolbox symlinks
# are done, and overwrites them
$(BUSYBOX_BINARY): toolbox
	@cp $(BUSYBOX_LOCAL_BINARY) $(BUSYBOX_BINARY)
	@echo "Installing busybox"
	@for tool in $(BUSYBOX_TOOLS) ; do \
		rm -rf $(BUSYBOX_INSTALL_DIR)/$$tool ; \
		ln -s busybox $(BUSYBOX_INSTALL_DIR)/$$tool ; \
	done

ALL_DEFAULT_INSTALLED_MODULES += $(BUSYBOX_BINARY)
